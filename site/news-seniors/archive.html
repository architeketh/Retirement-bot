<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>News Archive — Retirement Hub</title>
<link rel="stylesheet" href="../assets/styles.css?v=hero3">
</head>
<body>

<header class="topbar">
  <div class="wrap topbar-inner">
    <a class="brand" href="../">
      <img src="../assets/logo.svg" alt="" class="brand-logo" onerror="this.style.display='none'">
      <span class="brand-text">Retirement <strong>Hub</strong></span>
    </a>
    <nav class="topnav">
      <a href="../#links">Links</a>
      <a href="../#lifestyle">Lifestyle</a>
      <a href="../#financial">Financial</a>
      <a href="../#articles">Articles</a>
      <a href="./" class="contrast">Today</a>
    </nav>
  </div>
</header>

<main class="wrap" style="padding-top:18px">
  <h1 style="margin:0 0 10px">News Archive</h1>

  <div class="archive-toolbar" style="display:flex;gap:10px;flex-wrap:wrap;margin:6px 0 14px">
    <a class="btn" href="./">← Back to Today</a>
    <label style="display:flex;gap:8px;align-items:center">
      <span class="muted">Pick a date</span>
      <select id="daySel" style="padding:8px 10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff"></select>
    </label>
    <button id="loadDay" class="btn btn-primary">Load</button>
  </div>

  <div id="newsGrid" class="grid"></div>
</main>

<footer class="wrap footer">
  <p class="muted">Archive is auto-created daily during deploys. Most recent days appear first.</p>
</footer>

<script>
(function(){
  const daySel = document.getElementById('daySel');
  const loadBtn = document.getElementById('loadDay');
  const mount = document.getElementById('newsGrid');

  const esc = s => String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));
  const card = n => {
    const img = n.image ? `<img class="thumb" src="${esc(n.image)}" alt="">` : '';
    const date = n.published ? new Date(n.published).toLocaleDateString() : '';
    const sub = [n.source||'', date].filter(Boolean).join(' • ');
    const summary = (n.summary||'').trim();
    return `
      <article>
        ${img}
        <h3><a href="${esc(n.url||'#')}" target="_blank" rel="noopener">${esc(n.title||'(Untitled)')}</a></h3>
        ${sub?`<p class="muted" style="margin:.15rem 0 .35rem">${esc(sub)}</p>`:''}
        ${summary?`<p>${esc(summary).slice(0,180)}</p>`:''}
      </article>`;
  };

  async function loadIndex(){
    try{
      const r = await fetch('../data/archive/index.json?v=' + Date.now(), {cache:'no-store'});
      if(!r.ok) throw new Error('index load');
      const idx = await r.json();
      daySel.innerHTML = idx.map(d => `<option value="${esc(d.date)}">${esc(d.date)} (${d.total||0})</option>`).join('');
    }catch{
      daySel.innerHTML = '';
      mount.innerHTML = '<p>No archive index yet.</p>';
    }
  }

  async function loadDay(day){
    try{
      const r = await fetch(`../data/archive/${day}.json?v=` + Date.now(), {cache:'no-store'});
      if(!r.ok) throw new Error('day load');
      const data = await r.json();
      const items = Array.isArray(data) ? data : (data.items || []);
      mount.innerHTML = items.map(card).join('') || '<p>No items for that day.</p>';
    }catch{
      mount.innerHTML = '<p>Could not load that day.</p>';
    }
  }

  loadBtn.addEventListener('click', () => { if(daySel.value) loadDay(daySel.value); });

  // Init
  (async () => {
    await loadIndex();
    if (daySel.value) loadDay(daySel.value);
  })();
})();
</script>
</body>
</html>
